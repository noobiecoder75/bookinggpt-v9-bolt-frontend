[build]
  # Build command for the application
  command = "npm run build"
  
  # Directory to publish (Vite builds to 'dist' by default)
  publish = "dist"
  
  # Functions directory for Netlify Functions
  functions = "netlify/functions"

[build.environment]
  # Node version for build
  NODE_VERSION = "18"

# API redirects to backend server (for subscription system)
# Note: Update the 'to' URL when you deploy your backend to production
[[redirects]]
  from = "/api/subscriptions/*"
  to = "http://localhost:3001/api/subscriptions/:splat"
  status = 200
  force = true

[[redirects]]
  from = "/api/webhooks/*"
  to = "http://localhost:3001/api/webhooks/:splat"
  status = 200
  force = true

# API redirects to Netlify Functions (legacy)
[[redirects]]
  from = "/api/health"
  to = "/.netlify/functions/health"
  status = 200

# SPA redirect rules (backup to _redirects file)
[[redirects]]
  from = "/client/*"
  to = "/index.html"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Headers for security and performance
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"

[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable" 